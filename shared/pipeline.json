{
  "privacy": {
    "allowList": [
      "status",
      "errors[].code",
      "integracoes[].status",
      "integracoes[].erroMensagem"
    ],
    "crypto": {
      "enabled": true,
      "timeWindow": "hour"
    }
  },
  "analysis": {
    "signals": {
      "enabled": true,
      "includePaths": [
        "status",
        "statusPagamento",
        "assinatura.status",
        "pagamento.status",
        "integracoes[].nome",
        "integracoes[].status",
        "errors[].code",
        "errors[].erroCodigo",
        "ultimaAtualizacao",
        "dataCriacao"
      ],
      "rules": [
        {
          "id": "assinatura-ok-pagamento-pendente",
          "description": "Assinatura aprovada com pagamento pendente.",
          "when": {
            "all": [
              {
                "path": "assinatura.status",
                "equals": "OK"
              },
              {
                "path": "pagamento.status",
                "equals": "PENDENTE"
              }
            ]
          },
          "flag": "assinatura_ok_pagamento_pendente",
          "severity": "P1"
        },
        {
          "id": "integracao-com-erro",
          "description": "Uma integração retornou erro.",
          "when": {
            "any": [
              {
                "path": "integracoes[].status",
                "equals": "ERRO"
              },
              {
                "path": "integracoes[].status",
                "equals": "FALHA"
              }
            ]
          },
          "flag": "integracao_em_erro",
          "severity": "P2"
        }
      ]
    }
  },
  "runbooks": {
    "items": [
      {
        "id": "sensibilizacao-falha",
        "when": {
          "any": [
            {
              "path": "integracoes[].nome",
              "equals": "SENSIBILIZACAO"
            },
            {
              "path": "integracoes[].status",
              "equals": "ERRO"
            }
          ]
        },
        "title": "Falha na sensibilização",
        "severitySuggestion": "P1",
        "steps": [
          "Validar erroCodigo/erroMensagem",
          "Checar fila/reprocessamento",
          "Confirmar se houve mudança recente no serviço"
        ],
        "links": [
          "https://runbook-interno/sensibilizacao"
        ]
      },
      {
        "id": "pagamento-pendente",
        "when": {
          "any": [
            {
              "path": "statusPagamento",
              "equals": "PENDENTE"
            }
          ]
        },
        "title": "Pagamento pendente",
        "severitySuggestion": "P2",
        "steps": [
          "Validar status do gateway",
          "Confirmar tentativa de cobrança",
          "Checar comunicação com o cliente"
        ],
        "links": []
      }
    ]
  }
}
