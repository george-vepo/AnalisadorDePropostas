{
  "privacy": {
    "allowList": [
      "proposta.COD_PROPOSTA",
      "proposta.COD_VENDA",
      "proposta.COD_PRODUTO",
      "proposta.DTH_VENDA",
      "proposta.DTH_CADASTRO",
      "proposta.DTH_ALTERACAO",
      "proposta.STA_SITUACAO",
      "proposta.STA_ASSINATURA",
      "proposta.STA_PAGO",
      "proposta.DTA_SENSIBILIZACAO",
      "proposta.DES_ERRO_SENSIBILIZACAO",
      "proposta.COD_SISTEMA_ORIGEM",
      "proposta.COD_CANAL",
      "pagamento.*",
      "adesao.*",
      "demaisParcelas[].NUM_PARCELA",
      "demaisParcelas[].DTA_VENCIMENTO",
      "demaisParcelas[].VLR_PARCELA",
      "demaisParcelas[].STA_PAGO",
      "assinaturaDigital[].STA_ASSINATURA",
      "integracoes[].STA_STATUS",
      "integracoes[].DES_INTEGRACAO",
      "integracoes[].DES_MENSAGEM",
      "logs[].DTH_ACESSO",
      "logs[].DES_TIPO",
      "logs[].DES_ORIGEM",
      "logs[].STA_STATUS",
      "logs[].DES_ERRO_TECNICO",
      "erros[].COD_ERRO",
      "erros[].DES_ERRO",
      "erros[].DTH_ERRO",
      "set0[].STA_SITUACAO",
      "set0[].STA_ASSINATURA",
      "set0[].STA_PAGO",
      "set0[].DTA_CADASTRO",
      "set0[].DTA_ASSINATURA",
      "set0[].DES_ERRO_SENSIBILIZACAO",
      "set1[].COD_ERRO",
      "set1[].DES_ERRO"
    ],
    "crypto": {
      "enabled": true,
      "timeWindow": "hour",
      "format": "{{field}}:ENC[v1|{{window}}|{{nonceB64}}|{{cipherB64}}]"
    },
    "normalizer": {
      "maxDepth": 10,
      "maxArrayItems": 30,
      "maxStringLength": 800,
      "dropPaths": ["setX[].payload", "setX[].headers"],
      "keepPaths": []
    }
  },
  "analysis": {
    "signals": {
      "enabled": true,
      "maxItemsPerArray": 50,
      "includePaths": [
        "proposta.STA_SITUACAO",
        "proposta.STA_ASSINATURA",
        "proposta.STA_PAGO",
        "proposta.COD_SISTEMA_ORIGEM",
        "proposta.COD_CANAL",
        "pagamento.STA_PAGAMENTO",
        "adesao.STA_ADESAO",
        "integracoes[].STA_STATUS",
        "erros[].COD_ERRO"
      ],
      "rules": [
        {
          "id": "assinado-sem-pagamento",
          "description": "Assinatura concluída sem confirmação de pagamento.",
          "when": {
            "all": [
              { "path": "proposta.STA_ASSINATURA", "equals": "OK" },
              { "path": "proposta.STA_PAGO", "in": ["N", "NAO", "PENDENTE"] }
            ]
          },
          "flag": "ASSINADO_SEM_PAGAMENTO",
          "severity": "P1"
        },
        {
          "id": "sensibilizacao-com-erro",
          "description": "Sensibilização com erro registrado.",
          "when": {
            "any": [
              { "path": "proposta.DES_ERRO_SENSIBILIZACAO", "exists": true },
              { "path": "integracoes[].STA_STATUS", "equals": "ERRO" }
            ]
          },
          "flag": "SENSIBILIZACAO_COM_ERRO",
          "severity": "P2"
        }
      ]
    }
  },
  "runbooks": {
    "items": [
      {
        "id": "runbook-sensibilizacao",
        "when": {
          "any": [
            { "path": "integracoes[].STA_STATUS", "equals": "ERRO" },
            { "path": "signals.flags[]", "equals": "SENSIBILIZACAO_COM_ERRO" }
          ]
        },
        "title": "Falha na sensibilização",
        "severitySuggestion": "P1",
        "steps": [
          "Verificar fila de sensibilização e logs técnicos.",
          "Reprocessar integração se necessário.",
          "Confirmar status da proposta após o reprocessamento."
        ],
        "links": ["https://runbook-interno/sensibilizacao"]
      },
      {
        "id": "runbook-pagamento-pendente",
        "when": {
          "all": [
            { "path": "proposta.STA_ASSINATURA", "equals": "OK" },
            { "path": "proposta.STA_PAGO", "in": ["N", "NAO", "PENDENTE"] }
          ]
        },
        "title": "Pagamento pendente após assinatura",
        "severitySuggestion": "P2",
        "steps": [
          "Validar status de pagamento no gateway.",
          "Confirmar se houve conciliação financeira.",
          "Abrir chamado para financeiro se divergência persistir."
        ],
        "links": ["https://runbook-interno/pagamentos"]
      }
    ]
  },
  "openai": {
    "model": "gpt-5.2-mini",
    "temperature": 0.2,
    "systemPrompt": "Você é um analista de sustentação (nível SRE/Support). Seja direto e prático. Não invente fatos: use apenas o que estiver nos dados fornecidos. Campos no formato ENC[...] são opacos; não tente descriptografar nem inferir PII. Use nomes de tabelas/objetos e IDs técnicos como evidência quando existirem (ex.: campo/coluna, códigos de erro, status, traceId/requestId). Se faltarem dados para confirmar uma hipótese, diga o que está faltando e quais perguntas fazer. Formato obrigatório (texto, sem JSON): 1) Resumo (1–3 linhas) 2) Causa provável (1–3 hipóteses, em ordem de chance) 3) Evidências (bullet points citando campos/tabelas/valores) 4) Próximos passos (ações concretas) 5) Perguntas para confirmar (máximo 5). Dê peso maior para signals e runbooks.",
    "userPromptTemplate": "Analise a proposta {{proposalNumber}} com base nesses dados (já protegidos/criptografados quando aplicável):\n\n{{dataJson}}\n\nSiga exatamente o formato obrigatório:\n1) Resumo (1–3 linhas)\n2) Causa provável (1–3 hipóteses, em ordem de chance)\n3) Evidências (bullet points citando campos/tabelas/valores)\n4) Próximos passos (ações concretas)\n5) Perguntas para confirmar (máximo 5)",
    "projectId": "",
    "outputSchema": {
      "enabled": false,
      "name": "support_analysis",
      "strict": true,
      "schema": {
        "type": "object",
        "properties": {
          "title": { "type": "string" },
          "summary": { "type": "string" },
          "probable_cause": { "type": "string" },
          "confidence": { "type": "integer", "minimum": 0, "maximum": 100 },
          "severity": { "type": "string", "enum": ["P0", "P1", "P2", "P3", "UNKNOWN"] },
          "evidence": { "type": "array", "items": { "type": "string" } },
          "next_steps": { "type": "array", "items": { "type": "string" } },
          "questions": { "type": "array", "items": { "type": "string" } },
          "suggested_runbooks": { "type": "array", "items": { "type": "string" } }
        },
        "required": [
          "title",
          "summary",
          "probable_cause",
          "confidence",
          "severity",
          "evidence",
          "next_steps",
          "questions"
        ],
        "additionalProperties": false
      }
    }
  },
  "cache": {
    "enabled": true,
    "ttlSeconds": 600
  },
  "rateLimit": {
    "enabled": true,
    "windowSeconds": 300,
    "maxRequests": 30
  }
}
